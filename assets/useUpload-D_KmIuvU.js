import{r as w}from"./vue-vendor-DEVBTxx0.js";import{showToast as L}from"./vant-CoNmWDyF.js";function $(){const d=w(!1),g=w(0);function p(e={}){return new Promise((r,i)=>{const a=document.createElement("input");a.type="file",a.accept=e.accept||"*",a.multiple=e.multiple||!1,a.onchange=l=>{const n=Array.from(l.target.files);if(e.maxSize&&n.filter(t=>t.size>e.maxSize).length>0){L(`文件大小不能超过 ${x(e.maxSize)}`),i(new Error("File size exceeded"));return}r(e.multiple?n:n[0])},a.oncancel=()=>{i(new Error("User cancelled"))},a.click()})}function v(e={}){return p({accept:"image/*",maxSize:e.maxSize||5*1024*1024,multiple:e.multiple})}function z(e={}){return p({accept:"video/*",maxSize:e.maxSize||50*1024*1024,multiple:!1})}function E(e={}){return p({accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt",maxSize:e.maxSize||10*1024*1024,multiple:e.multiple})}function S(e,r,i={},a={}){d.value=!0,g.value=0;const l=new FormData;return l.append("file",r),Object.keys(i).forEach(n=>{l.append(n,i[n])}),new Promise((n,s)=>{const t=new XMLHttpRequest;t.upload.addEventListener("progress",o=>{o.lengthComputable&&(g.value=Math.round(o.loaded/o.total*100))}),t.addEventListener("load",()=>{if(d.value=!1,t.status>=200&&t.status<300)try{const o=JSON.parse(t.responseText);n(o)}catch{n(t.responseText)}else s(new Error(`Upload failed with status ${t.status}`))}),t.addEventListener("error",()=>{d.value=!1,s(new Error("Upload failed"))}),t.addEventListener("abort",()=>{d.value=!1,s(new Error("Upload aborted"))}),t.open("POST",e),a.headers&&Object.keys(a.headers).forEach(o=>{t.setRequestHeader(o,a.headers[o])}),t.send(l)})}function x(e){if(e===0)return"0 B";const r=1024,i=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/Math.pow(r,a)).toFixed(2))+" "+i[a]}function F(e){const r=e.name.toLowerCase();return r.match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)?"image":r.match(/\.(mp4|avi|mov|wmv|flv|mkv)$/)?"video":r.match(/\.(mp3|wav|ogg|m4a)$/)?"audio":r.match(/\.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt)$/)?"document":"file"}function M(e,r={}){return new Promise((i,a)=>{const l=r.maxWidth||1920,n=r.maxHeight||1920,s=r.quality||.8,t=new FileReader;t.readAsDataURL(e),t.onload=o=>{const c=new Image;c.src=o.target.result,c.onload=()=>{let m=c.width,u=c.height;if(m>l||u>n){const h=Math.min(l/m,n/u);m*=h,u*=h}const f=document.createElement("canvas");f.width=m,f.height=u,f.getContext("2d").drawImage(c,0,0,m,u),f.toBlob(h=>{i(new File([h],e.name,{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",s)},c.onerror=a},t.onerror=a})}return{uploading:d,progress:g,selectFile:p,selectImage:v,selectVideo:z,selectDocument:E,uploadWithProgress:S,formatFileSize:x,getFileType:F,compressImage:M}}export{$ as u};
