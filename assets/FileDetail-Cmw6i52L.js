import{_ as P}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{V as Q,_ as W,r as k,c as B,e as Y,P as g,Q as _,j as c,a4 as I,u,Z as y,B as j,Y as i,W as n,$ as N,y as Z,F as H}from"./vue-vendor-DEVBTxx0.js";import{u as J,b as O,y as X,o as ee,z as M}from"./index-tPAe9Dy4.js";import{NavBar as te,Icon as ae,Button as oe,Field as se,Dialog as ne,showToast as l,Loading as ce,Empty as le}from"./vant-CoNmWDyF.js";const ie={class:"file-detail-page"},re={key:1,class:"file-detail-content"},ue={class:"file-info-section"},de={class:"file-icon-wrapper"},_e={class:"file-name"},me={class:"file-meta"},ve={class:"file-size"},pe={class:"file-date"},fe={key:0,class:"review-status-section"},he={key:0,class:"rejection-reason"},we={class:"rejection-label"},ge={class:"rejection-text"},ye={class:"action-buttons"},ke={class:"reject-dialog-content"},je={__name:"FileDetail",setup(be){const p=Q(),b=W(),{t:a}=J(),x=O(),F=k(!0),s=k(null),f=k(!1),h=k(""),m=B(()=>{const e=parseInt(b.params.chatId||b.params.id);return isNaN(e)?null:e}),v=B(()=>{const e=parseInt(b.params.fileId);return isNaN(e)?null:e}),D=B(()=>{var t;const e=x.userType||((t=x.user)==null?void 0:t.user_type);return e==="company_admin"||e==="expert"}),T=e=>{if(!e||e===0)return"0 B";const t=1024,o=["B","KB","MB","GB"],d=Math.floor(Math.log(e)/Math.log(t)),r=Math.min(d,o.length-1);return Math.round(e/Math.pow(t,r)*100)/100+" "+o[r]},V=e=>{if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}},S=e=>{if(!e)return"status-pending";switch(e){case"accepted":return"status-accepted";case"rejected":return"status-rejected";default:return"status-pending"}},R=e=>{if(!e)return"clock-o";switch(e){case"accepted":return"success";case"rejected":return"cross";default:return"clock-o"}},U=e=>{if(!e)return a("chat.review_pending");switch(e){case"accepted":return a("chat.review_accepted");case"rejected":return a("chat.review_rejected");default:return a("chat.review_pending")}},q=()=>{var o;if(!((o=s.value)!=null&&o.file_url)){l(a("common.file_url_unavailable"));return}const e=ee(s.value.file_url),t=document.createElement("a");t.href=e,t.download=s.value.file_name||"file",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),l(a("common.downloading"))},E=async()=>{var e,t;if(!m.value||!v.value){l(a("common.invalid_params"));return}try{await M(m.value,v.value,"accept"),l(a("chat.file_accepted")),await z(),setTimeout(()=>{p.back()},1e3)}catch(o){console.error("Failed to accept file:",o);const d=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.error)||(o==null?void 0:o.message)||a("chat.accept_failed");l(d)}},L=async()=>{var e,t;if(!m.value||!v.value){l(a("common.invalid_params"));return}if(!h.value.trim()){l(a("chat.rejection_reason_required"));return}try{await M(m.value,v.value,"reject",h.value),l(a("chat.file_rejected")),f.value=!1,h.value="",await z(),setTimeout(()=>{p.back()},1e3)}catch(o){console.error("Failed to reject file:",o);const d=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.error)||(o==null?void 0:o.message)||a("chat.reject_failed");l(d)}},z=async()=>{if(!m.value||!v.value){l(a("common.invalid_params")),p.back();return}F.value=!0;try{const e=await X(m.value,v.value);s.value=e.file}catch(e){console.error("Failed to load file detail:",e),l(a("common.load_failed")),setTimeout(()=>{p.back()},1500)}finally{F.value=!1}},$=()=>{p.back()};return Y(()=>{z()}),(e,t)=>{const o=te,d=ce,r=ae,C=oe,A=le,G=se,K=ne;return _(),g("div",ie,[c(o,{title:u(a)("chat.file_detail"),"left-arrow":"",onClickLeft:$},null,8,["title"]),F.value?(_(),I(d,{key:0,size:"24",vertical:"",class:"loading-container"},{default:y(()=>[j(i(u(a)("common.loading")),1)]),_:1})):s.value?(_(),g("div",re,[n("div",ue,[n("div",de,[c(r,{name:"description",size:"48",color:"#0066FF"})]),n("h2",_e,i(s.value.file_name),1),n("div",me,[n("span",ve,i(T(s.value.file_size)),1),n("span",pe,i(V(s.value.created_at)),1)])]),s.value.requires_review?(_(),g("div",fe,[n("div",{class:Z(["status-badge",S(s.value.review_status)])},[c(r,{name:R(s.value.review_status),size:"16"},null,8,["name"]),n("span",null,i(U(s.value.review_status)),1)],2),s.value.review_status==="rejected"&&s.value.rejection_reason?(_(),g("div",he,[n("div",we,i(u(a)("chat.rejection_reason")),1),n("div",ge,i(s.value.rejection_reason),1)])):N("",!0)])):N("",!0),n("div",ye,[c(C,{type:"primary",size:"large",block:"",onClick:q,class:"download-btn"},{default:y(()=>[c(r,{name:"arrow-down"}),j(" "+i(u(a)("common.download")),1)]),_:1}),D.value&&s.value.requires_review&&(!s.value.review_status||s.value.review_status==="pending")?(_(),g(H,{key:0},[c(C,{type:"success",size:"large",block:"",onClick:E,class:"accept-btn"},{default:y(()=>[c(r,{name:"success"}),j(" "+i(u(a)("chat.accept")),1)]),_:1}),c(C,{type:"danger",size:"large",block:"",onClick:t[0]||(t[0]=w=>f.value=!0),class:"reject-btn"},{default:y(()=>[c(r,{name:"cross"}),j(" "+i(u(a)("chat.reject")),1)]),_:1})],64)):N("",!0)])])):(_(),I(A,{key:2,description:"文件不存在"})),c(K,{show:f.value,"onUpdate:show":t[2]||(t[2]=w=>f.value=w),title:u(a)("chat.reject_file"),"show-cancel-button":!0,"show-confirm-button":!0,onConfirm:L,onCancel:t[3]||(t[3]=w=>f.value=!1)},{default:y(()=>[n("div",ke,[c(G,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=w=>h.value=w),type:"textarea",placeholder:u(a)("chat.rejection_reason_placeholder"),rows:"4",maxlength:"1000","show-word-limit":"",autosize:""},null,8,["modelValue","placeholder"])])]),_:1},8,["show","title"])])}}},Re=P(je,[["__scopeId","data-v-f2275cc3"]]);export{Re as default};
