import{_ as E}from"./_plugin-vue_export-helper-BgbHP9iJ.js";import{_ as F}from"./user-edit-g9GcqIQt.js";import{r as k,c as V,w as O,e as U,o as Y,a4 as J,Q as l,j as h,Z as P,P as c,$,W as s,F as q,X as M,y as N,a5 as T,T as D,Y as r,B as K,q as W,V as j,u as _}from"./vue-vendor-DEVBTxx0.js";import{k as Q,u as X,b as Z}from"./index-tPAe9Dy4.js";import{C as G}from"./CustomNavBar-BJGtUQrX.js";import{Icon as R}from"./vant-CoNmWDyF.js";import{A as ss}from"./AppTabBar-Bp-nD9mT.js";import{g as es}from"./organization-CXFvl_zb.js";import{g as ts}from"./consultation-CmWwUlcj.js";import"./index_logo-B4Lpufyb.js";const os=""+new URL("../images/index/company.png",import.meta.url).href,B=""+new URL("../images/index/document-copy.png",import.meta.url).href,as=""+new URL("../images/index/people.png",import.meta.url).href,is=""+new URL("../images/index/document.png",import.meta.url).href;function ns(){return Q("/announcements")}const rs={class:"story-progress"},ls=["src"],cs={class:"story-info"},ds={class:"story-title"},us={key:0,class:"story-description"},vs={key:1,class:"story-action"},ms=["href"],ps={class:"story-nav"},_s=5e3,ys={__name:"StoryViewer",props:{visible:{type:Boolean,default:!1},stories:{type:Array,required:!0},initialIndex:{type:Number,default:0}},emits:["update:visible","close","view"],setup(x,{emit:f}){const t=x,o=f,u=k(t.initialIndex),y=k(null),v=V(()=>t.stories[u.value]||{}),m=()=>{},d=()=>{u.value>0&&(u.value--,S(),o("view",v.value.id))},w=()=>{u.value<t.stories.length-1?(u.value++,S(),o("view",v.value.id)):b()},b=()=>{o("update:visible",!1),o("close"),g()},I=n=>{n.target.classList.contains("story-viewer")&&b()},C=n=>{if(t.visible)switch(n.key){case"Escape":b();break;case"ArrowLeft":d();break;case"ArrowRight":w();break}},a=()=>{g(),y.value=setTimeout(()=>{w()},_s)},g=()=>{y.value&&(clearTimeout(y.value),y.value=null)},S=()=>{t.visible&&a()};return O(()=>t.visible,n=>{n?(u.value=t.initialIndex,a(),document.body.style.overflow="hidden"):(g(),document.body.style.overflow="")}),O(()=>t.initialIndex,n=>{u.value=n}),U(()=>{window.addEventListener("keydown",C),t.visible&&(a(),document.body.style.overflow="hidden")}),Y(()=>{window.removeEventListener("keydown",C),g(),document.body.style.overflow=""}),(n,i)=>{const e=R;return l(),J(W,{to:"body"},[h(D,{name:"story-fade"},{default:P(()=>[x.visible?(l(),c("div",{key:0,class:"story-viewer",onClick:I},[s("div",rs,[(l(!0),c(q,null,M(x.stories,(A,p)=>(l(),c("div",{key:A.id,class:"progress-bar"},[s("div",{class:N(["progress-fill",{active:p===u.value,completed:p<u.value}])},null,2)]))),128))]),s("div",{class:"story-close",onClick:T(b,["stop"])},[h(e,{name:"cross",size:"24",color:"#fff"})]),s("div",{class:"story-content",onClick:i[1]||(i[1]=T(()=>{},["stop"]))},[h(D,{name:"story-slide",mode:"out-in"},{default:P(()=>[(l(),c("div",{key:v.value.id,class:"story-item"},[v.value.image_url?(l(),c("img",{key:0,src:v.value.image_url,class:"story-image",onLoad:m},null,40,ls)):$("",!0),s("div",cs,[s("h2",ds,r(v.value.title),1),v.value.description?(l(),c("p",us,r(v.value.description),1)):$("",!0)]),v.value.link?(l(),c("div",vs,[s("a",{href:v.value.link,target:"_blank",class:"story-link-btn",onClick:i[0]||(i[0]=T(()=>{},["stop"]))},[i[2]||(i[2]=K(" 查看详情 ",-1)),h(e,{name:"arrow"})],8,ms)])):$("",!0)]))]),_:1})]),s("div",ps,[s("div",{class:"nav-area nav-prev",onClick:T(d,["stop"])}),s("div",{class:"nav-area nav-next",onClick:T(w,["stop"])})])])):$("",!0)]),_:1})])}}},fs=E(ys,[["__scopeId","data-v-2d730312"]]),hs={class:"announcement-stories"},gs={class:"stories-container"},ws=["onClick"],bs={class:"story-image-wrapper"},ks=["src","alt"],Cs={key:1,class:"story-placeholder"},Ss={class:"story-title-bar"},As={class:"story-title"},H="kelisim_viewed_announcements",$s={__name:"AnnouncementStories",setup(x,{expose:f}){const t=k([]),o=k(!1),u=k(0),y=k(new Set),v=()=>{try{const a=localStorage.getItem(H);a&&(y.value=new Set(JSON.parse(a)))}catch(a){console.error("Failed to load viewed stories:",a)}},m=()=>{try{localStorage.setItem(H,JSON.stringify([...y.value]))}catch(a){console.error("Failed to save viewed stories:",a)}},d=a=>{y.value.add(a),m()},w=a=>y.value.has(a),b=async()=>{try{const a=await ns();t.value=a.data||[]}catch(a){console.error("Failed to load announcements:",a)}},I=a=>{u.value=a,o.value=!0,t.value[a]&&d(t.value[a].id)},C=()=>{o.value=!1};return U(()=>{v(),b()}),f({isViewed:w}),(a,g)=>{const S=R;return l(),c("div",hs,[s("div",gs,[(l(!0),c(q,null,M(t.value,(n,i)=>(l(),c("div",{key:n.id,class:N(["story-card",{viewed:w(n.id)}]),onClick:e=>I(i)},[s("div",bs,[n.thumbnail_url?(l(),c("img",{key:0,src:n.thumbnail_url,class:"story-image",alt:n.title},null,8,ks)):(l(),c("div",Cs,[h(S,{name:"photo-o",size:"48",color:"#4A90E2"})]))]),s("div",Ss,[s("span",As,r(n.title),1)])],10,ws))),128))]),h(fs,{visible:o.value,"onUpdate:visible":g[0]||(g[0]=n=>o.value=n),stories:t.value,"initial-index":u.value,onClose:C,onView:d},null,8,["visible","stories","initial-index"])])}}},xs=E($s,[["__scopeId","data-v-8f521e95"]]),Is={class:"content"},Ls={class:"company-info"},Ts={class:"company-name"},Vs={class:"company-id"},Ns={class:"dashboard"},zs={class:"stat-item"},Bs={class:"stat-num"},Es={class:"stat-label"},Us={class:"stat-item"},Rs={class:"stat-num"},Fs={class:"stat-label"},Os={class:"stat-num"},Ps={class:"stat-label"},Ds={class:"stat-num"},Hs={class:"stat-label"},qs={class:"stat-num"},Ms={class:"stat-label"},Ys={class:"apply-content"},Js={class:"apply-title"},Ks={class:"apply-desc"},Ws={class:"apply-content"},js={class:"apply-title"},Qs={class:"apply-desc"},Xs={__name:"Home",setup(x){const f=j(),{t}=X(),o=Z(),u=V(()=>{var i;return((i=o.organizations[0])==null?void 0:i.name)||""}),y=V(()=>{var i;return((i=o.organizations[0])==null?void 0:i.company_id)||""}),v=V(()=>{var i;return o.isCompanyAdmin?!0:o.isExpert?(((i=o.user)==null?void 0:i.permissions)||{}).can_apply_consultation===!0:!1}),m=k({members:0,cases:0,archived:0}),d=k(!1),w=async()=>{if(!o.isLawyer&&(!o.organizations||o.organizations.length===0))try{await o.fetchUserOrganizations()}catch(i){console.error("Failed to load organizations:",i);return}await b()},b=async()=>{var i,e,A;d.value=!0;try{if(o.isLawyer){const p=await ts(),L=p.data||p;m.value={in_progress:L.in_progress||0,archived:L.archived||0}}else{const p=o.organizations[0];if(!(p!=null&&p.id)){m.value={members:0,cases:0,archived:0};return}const L=await es(p.id),z=L.stats||L.data||{};m.value={members:((i=z.members)==null?void 0:i.total)||0,cases:((e=z.consultations)==null?void 0:e.in_progress)||0,archived:((A=z.consultations)==null?void 0:A.archived)||0}}}catch(p){console.error("Failed to load stats:",p),o.isLawyer?m.value={in_progress:0,archived:0}:m.value={members:0,cases:0,archived:0}}finally{d.value=!1}};U(()=>{w()});function I(){f.push({name:"Apply"})}function C(){f.push({name:"CompanyManage"})}function a(){f.push({name:"History",query:{status:"in_progress"}})}function g(){f.push({name:"History",query:{status:"archived"}})}function S(){f.push({name:"History"})}function n(){f.push({name:"Notifications"})}return(i,e)=>{const A=R;return l(),c("div",null,[h(G,{title:"","show-bell":!0,onBellClick:n}),s("div",Is,[h(xs),_(o).isLawyer?$("",!0):(l(),c("div",{key:0,class:"company",onClick:C},[e[0]||(e[0]=s("img",{src:os,alt:""},null,-1)),s("div",Ls,[s("p",Ts,r(u.value),1),s("p",Vs,r(y.value),1)]),h(A,{name:"arrow",class:"arrow-icon"})])),s("div",Ns,[_(o).isLawyer?(l(),c("div",{key:0,class:N(["stats-bar",{loading:d.value}])},[s("div",zs,[e[1]||(e[1]=s("img",{class:"stat-icon",src:F},null,-1)),s("span",Bs,r(d.value?"-":m.value.in_progress),1),s("span",Es,r(_(t)("home.lawyer.in_progress")),1)]),e[3]||(e[3]=s("div",{class:"stat-divider"},null,-1)),s("div",Us,[e[2]||(e[2]=s("img",{class:"stat-icon",src:B},null,-1)),s("span",Rs,r(d.value?"-":m.value.archived),1),s("span",Fs,r(_(t)("home.lawyer.archived")),1)])],2)):(l(),c("div",{key:1,class:N(["stats-bar",{loading:d.value}])},[s("div",{class:"stat-item",onClick:C},[e[4]||(e[4]=s("img",{class:"stat-icon",src:as},null,-1)),s("span",Os,r(d.value?"-":m.value.members),1),s("span",Ps,r(_(t)("home.organization_members")),1)]),e[7]||(e[7]=s("div",{class:"stat-divider"},null,-1)),s("div",{class:"stat-item",onClick:a},[e[5]||(e[5]=s("img",{class:"stat-icon",src:is},null,-1)),s("span",Ds,r(d.value?"-":m.value.cases),1),s("span",Hs,r(_(t)("home.active_cases")),1)]),e[8]||(e[8]=s("div",{class:"stat-divider"},null,-1)),s("div",{class:"stat-item",onClick:g},[e[6]||(e[6]=s("img",{class:"stat-icon",src:F},null,-1)),s("span",qs,r(d.value?"-":m.value.archived),1),s("span",Ms,r(_(t)("home.archived_cases")),1)])],2)),_(o).isLawyer?(l(),c("div",{key:2,class:"apply-card",onClick:S},[e[9]||(e[9]=s("div",{class:"apply-icon"},[s("img",{src:B})],-1)),s("div",Ys,[s("p",Js,r(_(t)("home.lawyer.view_consultations")),1),s("p",Ks,r(_(t)("home.lawyer.view_consultations_desc")),1)])])):v.value?(l(),c("div",{key:3,class:"apply-card",onClick:I},[e[10]||(e[10]=s("div",{class:"apply-icon"},[s("img",{src:B})],-1)),s("div",Ws,[s("p",js,r(_(t)("home.submit_new_application")),1),s("p",Qs,r(_(t)("home.submit_application_desc")),1)])])):$("",!0)])]),h(ss,{"active-tab":"home"})])}}},le=E(Xs,[["__scopeId","data-v-8b4a815b"]]);export{le as default};
