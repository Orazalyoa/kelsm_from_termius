import{V as q,_ as A,r as p,c as R,e as U,P as r,Q as d,j as P,W as s,s as j,u as a,Y as c,a2 as F,F as Q,X as W,y as V,$ as v,A as X}from"./vue-vendor-DEVBTxx0.js";import{_ as Y}from"./user-edit-g9GcqIQt.js";import{u as G}from"./index-tPAe9Dy4.js";import{C as H}from"./CustomNavBar-BJGtUQrX.js";import{d as B}from"./consultation-CmWwUlcj.js";import{_ as J}from"./_plugin-vue_export-helper-BgbHP9iJ.js";import{showToast as f,showLoadingToast as y,closeToast as D,showSuccessToast as K}from"./vant-CoNmWDyF.js";import"./index_logo-B4Lpufyb.js";const O={class:"apply-detail-page"},Z={class:"topic-bar"},ee={class:"topic-title"},te={class:"section-label"},se=["placeholder"],oe={class:"section-label"},le=["placeholder"],ae={class:"section-label"},ie={class:"section-desc"},ne={class:"file-list"},ce=["onClick"],pe=["src"],re={class:"file-info"},de={class:"file-name"},ue={class:"file-size"},me={key:0,class:"upload-progress"},_e={class:"progress-bar"},ge={class:"progress-text"},fe={key:0,class:"file-checked"},he={key:1,class:"file-uploading"},ve={class:"attach-link"},ye=["disabled"],be={__name:"Detail",setup(ke){const N=q(),b=A(),{t}=G(),k=p(""),u=p(""),C=p(""),m=p(""),i=p([]),_=p(!1),z=p(null),w=R(()=>!u.value.trim()||!m.value.trim()||_.value);function I(){z.value.click()}function M(l){var T;const o=l.target.files[0];if(!o)return;const e=o.name,n=(T=e.split(".").pop())==null?void 0:T.toLowerCase();if(!["pdf","doc","docx","jpg","jpeg","png","zip"].includes(n)){f(t("apply.only_allowed_types"));return}const x=o.size;if(i.value.reduce((L,S)=>L+(S.file?S.file.size:0),0)+x>100*1024*1024){f(t("common.file_size_exceeded"));return}let h="/images/common/doc.png";n==="pdf"?h="/images/common/pdf.png":(["jpg","jpeg","png"].includes(n)||n==="zip")&&(h="/images/common/doc.png"),i.value.push({icon:h,name:e,size:`${(x/1024/1024).toFixed(1)} MB`,checked:!0,uploading:!1,progress:0,file:o}),K(t("common.file_added")),l.target.value=""}function $(l){i.value[l].checked=!i.value[l].checked}async function E(){if(!u.value.trim()){f(t("apply.consultation_title")+" "+t("common.cannot_be_empty"));return}if(!m.value.trim()){f(t("apply.problem_description")+" "+t("common.cannot_be_empty"));return}if(!_.value){_.value=!0;try{const l={topic_type:C.value,title:u.value.trim(),description:m.value.trim(),priority:"medium"},o=i.value.filter(e=>e.checked).map(e=>e.file);o.length>0?(y({message:t("apply.uploading")+" 0%",forbidClick:!0,duration:0}),i.value.forEach(e=>{e.checked&&(e.uploading=!0,e.progress=0)}),await B(l,o,e=>{const n=Math.round(e.loaded*100/e.total);i.value.forEach(g=>{g.checked&&g.uploading&&(g.progress=n)}),y({message:t("apply.uploading")+` ${n}%`,forbidClick:!0,duration:0})})):(y({message:t("common.submitting"),forbidClick:!0}),await B(l,o)),D(),N.replace({name:"ApplySuccess"})}catch(l){D(),console.error("提交失败:",l),f(l.message||t("common.submit_failed")),i.value.forEach(o=>{o.uploading=!1,o.progress=0})}finally{_.value=!1}}}return U(()=>{k.value=b.query.title||t("apply.legal_consultation"),C.value=b.query.type||"legal_consultation"}),(l,o)=>(d(),r("div",O,[P(H,{"show-logo":!1,title:a(t)("apply.title")},null,8,["title"]),s("div",Z,[o[2]||(o[2]=s("img",{src:Y,class:"topic-icon"},null,-1)),s("div",ee,c(k.value),1)]),s("div",te,c(a(t)("apply.consultation_title")),1),j(s("input",{class:"title-input","onUpdate:modelValue":o[0]||(o[0]=e=>u.value=e),placeholder:a(t)("apply.enter_title"),type:"text"},null,8,se),[[F,u.value]]),s("div",oe,c(a(t)("apply.problem_description")),1),j(s("textarea",{class:"problem-input","onUpdate:modelValue":o[1]||(o[1]=e=>m.value=e),placeholder:a(t)("apply.describe_task"),rows:"5"},null,8,le),[[F,m.value]]),s("div",ae,c(a(t)("apply.additional_attachments")),1),s("div",ie,c(a(t)("apply.attachment_desc")),1),s("div",ne,[(d(!0),r(Q,null,W(i.value,(e,n)=>(d(),r("div",{key:n,class:V(["file-item",{checked:e.checked,uploading:e.uploading}]),onClick:g=>!e.uploading&&$(n)},[s("img",{src:e.icon,class:"file-icon"},null,8,pe),s("div",re,[s("div",de,c(e.name),1),s("div",ue,c(e.size),1),e.uploading?(d(),r("div",me,[s("div",_e,[s("div",{class:"progress-fill",style:X({width:e.progress+"%"})},null,4)]),s("span",ge,c(e.progress)+"%",1)])):v("",!0)]),e.checked&&!e.uploading?(d(),r("div",fe,"✓")):v("",!0),e.uploading?(d(),r("div",he,"⏳")):v("",!0)],10,ce))),128))]),s("div",{class:"attach-file",onClick:I},[s("span",ve,c(i.value.length>0?a(t)("apply.attach_more_file"):a(t)("apply.attach_file")),1)]),s("button",{class:V(["submit-btn",{disabled:w.value}]),disabled:w.value,onClick:E},c(_.value?a(t)("common.submitting"):a(t)("apply.submit_application")),11,ye),s("input",{ref_key:"fileInput",ref:z,type:"file",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.zip",style:{display:"none"},onChange:M},null,544)]))}},Be=J(be,[["__scopeId","data-v-ec048e21"]]);export{Be as default};
