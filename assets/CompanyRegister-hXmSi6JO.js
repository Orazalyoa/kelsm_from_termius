import{_ as z}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{V as N,r as f,c as D,P as E,Q as I,j as d,W as o,u as l,a5 as O,s as i,Y as r,a2 as u,y as P,Z as y,B as j}from"./vue-vendor-DEVBTxx0.js";import{u as R,b as F,j as x}from"./index-tPAe9Dy4.js";import{c as G}from"./organization-CXFvl_zb.js";import{h as V}from"./errorHandler-D1LKPKx3.js";import{NavBar as M,Icon as $,Button as q,Picker as A,Popup as H,showSuccessToast as L}from"./vant-CoNmWDyF.js";const Q={class:"company-register-container"},W={class:"main-content"},Y={class:"form-group"},Z={class:"form-label"},J=["placeholder"],K={class:"form-group"},X={class:"form-label"},ee=["placeholder"],ae={class:"form-group"},oe={class:"form-label"},te=["placeholder"],le={class:"form-group"},ne={class:"form-label"},se={class:"form-group"},re={class:"form-label"},ie=["placeholder"],ue={class:"form-group"},pe={class:"form-label"},me=["placeholder"],ce={class:"form-group"},de={class:"form-label"},_e=["placeholder"],fe={class:"form-group"},he={class:"form-label"},ve=["placeholder"],ge={class:"button-container"},be={__name:"CompanyRegister",setup(we){const h=N(),{t}=R(),v=F(),e=f({company_name:"",bin:"",full_name:"",gender:"male",phone:"",country_code:"+7",email:"",password:"",password_confirmation:""}),m=f(!1),c=f(!1),g=[{text:t("auth.male"),value:"male"},{text:t("auth.female"),value:"female"}],b=D(()=>{const s=g.find(a=>a.value===e.value.gender);return s?s.text:""});function k(){h.back()}function U({selectedOptions:s}){e.value.gender=s[0].value,c.value=!1}function C(s){const a=s.trim().split(/\s+/);return a.length>=2?{last_name:a[0],first_name:a.slice(1).join(" ")}:a.length===1?{last_name:a[0],first_name:a[0]}:{last_name:"",first_name:""}}async function B(){m.value=!0;try{if(!e.value.email&&!e.value.phone){x(t("validation.email_or_phone_required")),m.value=!1;return}if(e.value.password!==e.value.password_confirmation){x(t("validation.password_mismatch")),m.value=!1;return}const{first_name:s,last_name:a}=C(e.value.full_name),p={user_type:"company_admin",first_name:s,last_name:a,gender:e.value.gender,password:e.value.password,password_confirmation:e.value.password_confirmation};e.value.email&&(p.email=e.value.email),e.value.phone&&(p.phone=e.value.phone,p.country_code=e.value.country_code);const w=await v.register(p);try{await G({name:e.value.company_name,company_id:e.value.bin,description:"",contact_name:e.value.full_name,phone:e.value.phone||null,email:e.value.email||null}),console.log("Organization created successfully"),await v.fetchUserOrganizations()}catch(_){console.error("Failed to create organization:",_),V(_,t("common.org_create_failed_later"))}L(t("auth.register_success")),localStorage.removeItem("temp_user_type"),setTimeout(()=>{h.replace({name:"Home"})},1500)}catch(s){V(s,t("auth.register_failed"))}finally{m.value=!1}}return(s,a)=>{const p=M,w=$,_=q,S=A,T=H;return I(),E("div",Q,[d(p,{title:l(t)("auth.company_info_title"),"left-arrow":"",onClickLeft:k},null,8,["title"]),o("div",W,[o("form",{onSubmit:O(B,["prevent"])},[o("div",Y,[o("label",Z,r(l(t)("auth.company_name")),1),i(o("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>e.value.company_name=n),type:"text",class:"form-input",placeholder:l(t)("auth.company_name_placeholder")},null,8,J),[[u,e.value.company_name]])]),o("div",K,[o("label",X,r(l(t)("auth.bin")),1),i(o("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>e.value.bin=n),type:"text",class:"form-input",placeholder:l(t)("auth.bin_placeholder")},null,8,ee),[[u,e.value.bin]])]),o("div",ae,[o("label",oe,r(l(t)("auth.full_name")),1),i(o("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>e.value.full_name=n),type:"text",class:"form-input",placeholder:l(t)("auth.full_name_placeholder")},null,8,te),[[u,e.value.full_name]])]),o("div",le,[o("label",ne,r(l(t)("auth.gender")),1),o("div",{class:"form-input form-select",onClick:a[3]||(a[3]=n=>c.value=!0)},[o("span",{class:P({placeholder:!b.value})},r(b.value||l(t)("auth.select_gender")),3),d(w,{name:"arrow-down"})])]),o("div",se,[o("label",re,r(l(t)("auth.phone_number")),1),i(o("input",{"onUpdate:modelValue":a[4]||(a[4]=n=>e.value.phone=n),type:"tel",class:"form-input",placeholder:l(t)("auth.phone_number_placeholder")},null,8,ie),[[u,e.value.phone]])]),o("div",ue,[o("label",pe,r(l(t)("auth.email")),1),i(o("input",{"onUpdate:modelValue":a[5]||(a[5]=n=>e.value.email=n),type:"email",class:"form-input",placeholder:l(t)("auth.email_placeholder")},null,8,me),[[u,e.value.email]])]),o("div",ce,[o("label",de,r(l(t)("auth.password")),1),i(o("input",{"onUpdate:modelValue":a[6]||(a[6]=n=>e.value.password=n),type:"password",class:"form-input",placeholder:l(t)("auth.password_placeholder")},null,8,_e),[[u,e.value.password]])]),o("div",fe,[o("label",he,r(l(t)("auth.password_confirmation")),1),i(o("input",{"onUpdate:modelValue":a[7]||(a[7]=n=>e.value.password_confirmation=n),type:"password",class:"form-input",placeholder:l(t)("auth.password_confirmation_placeholder")},null,8,ve),[[u,e.value.password_confirmation]])]),o("div",ge,[d(_,{type:"primary",block:"",round:"","native-type":"submit",loading:m.value},{default:y(()=>[j(r(l(t)("auth.continue")),1)]),_:1},8,["loading"])])],32)]),d(T,{show:c.value,"onUpdate:show":a[9]||(a[9]=n=>c.value=n),position:"bottom",round:""},{default:y(()=>[d(S,{columns:g,onConfirm:U,onCancel:a[8]||(a[8]=n=>c.value=!1)})]),_:1},8,["show"])])}}},Ee=z(be,[["__scopeId","data-v-4b99ebc2"]]);export{Ee as default};
