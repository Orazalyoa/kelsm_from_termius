import{V as K,r as _,c as Q,e as W,P as c,Q as l,j as X,W as n,u,$ as p,Y as r,F as Y,X as Z,y as q,a5 as G}from"./vue-vendor-DEVBTxx0.js";import{_ as H}from"./doc-0ztv5d3O.js";import{k as A,A as w,B as J,u as tt,j as h,f as k}from"./index-tPAe9Dy4.js";import{C as et}from"./CustomNavBar-BJGtUQrX.js";import{_ as at}from"./_plugin-vue_export-helper-BgbHP9iJ.js";import"./vant-CoNmWDyF.js";import"./index_logo-B4Lpufyb.js";function ot(f){return A("/notifications",f)}function nt(){return A("/notifications/unread-count")}function st(f){return w(`/notifications/${f}/read`)}function it(){return w("/notifications/mark-all-read")}function rt(f){return J(`/notifications/${f}`)}function ct(){return w("/notifications/clear-read")}const lt={class:"notifications-page"},ut={class:"notifications-container"},dt={key:0,class:"actions-bar"},ft=["disabled"],_t={key:1,class:"notifications-list"},mt=["onClick"],yt={class:"notification-content"},pt={class:"notification-header"},ht={class:"notification-title"},vt={key:0,class:"unread-badge"},gt={class:"notification-body"},kt={class:"notification-footer"},wt={class:"notification-time"},bt={class:"notification-type"},Ct={class:"notification-actions"},Mt=["onClick"],St={key:0,class:"load-more"},Nt=["disabled"],$t={key:2,class:"empty-state"},xt={class:"empty-text"},Pt={key:3,class:"loading-state"},Ft={__name:"Index",setup(f){const b=K(),{t:o}=tt(),i=_([]),m=_(!1),y=_(!1),v=_(1),C=_(1),d=_(0),M=Q(()=>v.value<C.value);async function S(t=1){try{t===1?m.value=!0:y.value=!0;const e=await ot({page:t,per_page:20});e.success&&(t===1?i.value=e.data:i.value.push(...e.data),v.value=e.pagination.current_page,C.value=e.pagination.last_page)}catch(e){console.error("Failed to fetch notifications:",e),h(o("notifications.load_failed"))}finally{m.value=!1,y.value=!1}}async function D(){try{const t=await nt();t.success&&(d.value=t.count)}catch(t){console.error("Failed to fetch unread count:",t)}}async function I(t){var e,a;if(!t.is_read)try{await st(t.id),t.is_read=!0,t.read_at=new Date().toISOString(),d.value=Math.max(0,d.value-1)}catch(s){console.error("Failed to mark as read:",s)}(e=t.data)!=null&&e.consultation_id?b.push(`/history/detail/${t.data.consultation_id}`):(a=t.data)!=null&&a.chat_id&&b.push(`/chat/detail/${t.data.chat_id}`)}async function B(){try{(await it()).success&&(i.value.forEach(e=>{e.is_read=!0,e.read_at=new Date().toISOString()}),d.value=0,k(o("notifications.mark_all_success")))}catch(t){console.error("Failed to mark all as read:",t),h(o("notifications.operation_failed"))}}async function R(t){try{if((await rt(t)).success){const a=i.value.findIndex(s=>s.id===t);a>-1&&(i.value[a].is_read||(d.value=Math.max(0,d.value-1)),i.value.splice(a,1)),k(o("notifications.delete_success"))}}catch(e){console.error("Failed to delete notification:",e),h(o("notifications.delete_failed"))}}async function T(){try{(await ct()).success&&(i.value=i.value.filter(e=>!e.is_read),k(o("notifications.clear_success")))}catch(t){console.error("Failed to clear read notifications:",t),h(o("notifications.operation_failed"))}}function V(){!M.value||y.value||S(v.value+1)}function j(t){if(!t)return"";const e=new Date(t),s=new Date-e;return s<6e4?o("common.just_now"):s<36e5?`${Math.floor(s/6e4)}分钟前`:s<864e5?`${Math.floor(s/36e5)}小时前`:s<6048e5?`${Math.floor(s/864e5)}天前`:e.toLocaleDateString("en-CA",{timeZone:"Asia/Almaty",year:"numeric",month:"2-digit",day:"2-digit"})}function E(t){return{consultation_status:o("notifications.type_consultation"),consultation_assignment:o("notifications.type_consultation_assignment"),consultation_priority:o("notifications.type_consultation_priority"),system:o("notifications.type_system"),message:o("notifications.type_message"),announcement:o("notifications.type_announcement")}[t]||o("notifications.title")}function L(t){return N(t,"title")}function O(t){return N(t,"body")}function N(t,e){var P;if(!t)return"";const a=(P=t.data)==null?void 0:P.translation,s=e==="title"?"title_key":"body_key",g=a==null?void 0:a[s];if(g){const z=U(a.params||{}),F=o(g,z);if(F!==g)return F}return e==="title"?t.title||"":t.content||""}function U(t={}){const e={...t};return e.oldStatus&&(e.oldStatus=$(e.oldStatus)),e.newStatus&&(e.newStatus=$(e.newStatus)),e.oldPriority&&(e.oldPriority=x(e.oldPriority)),e.newPriority&&(e.newPriority=x(e.newPriority)),e}function $(t){if(!t)return"";const e=`status.${t}`,a=o(e);return a!==e?a:t}function x(t){if(!t)return"";const e=`notifications.priority.${t}`,a=o(e);return a!==e?a:t}return W(()=>{S(),D()}),(t,e)=>(l(),c("div",lt,[X(et,{"show-logo":!1,title:u(o)("notifications.title")},null,8,["title"]),n("div",ut,[i.value.length>0?(l(),c("div",dt,[n("button",{class:"action-btn",onClick:B,disabled:d.value===0},r(u(o)("notifications.mark_all_read")),9,ft),n("button",{class:"action-btn",onClick:T},r(u(o)("notifications.clear_read")),1)])):p("",!0),!m.value&&i.value.length>0?(l(),c("div",_t,[(l(!0),c(Y,null,Z(i.value,a=>(l(),c("div",{key:a.id,class:q(["notification-item",{unread:!a.is_read}]),onClick:s=>I(a)},[n("div",yt,[n("div",pt,[n("span",ht,r(L(a)),1),a.is_read?p("",!0):(l(),c("span",vt))]),n("div",gt,r(O(a)),1),n("div",kt,[n("span",wt,r(j(a.created_at)),1),n("span",bt,r(E(a.type)),1)])]),n("div",Ct,[n("button",{class:"delete-btn",onClick:G(s=>R(a.id),["stop"])},r(u(o)("common.delete")),9,Mt)])],10,mt))),128)),M.value?(l(),c("div",St,[n("button",{class:"load-more-btn",onClick:V,disabled:y.value},r(y.value?u(o)("common.loading"):u(o)("notifications.load_more")),9,Nt)])):p("",!0)])):m.value?p("",!0):(l(),c("div",$t,[e[0]||(e[0]=n("img",{src:H,class:"empty-icon"},null,-1)),n("p",xt,r(u(o)("notifications.no_notifications")),1)])),m.value?(l(),c("div",Pt,[e[1]||(e[1]=n("div",{class:"spinner"},null,-1)),n("p",null,r(u(o)("common.loading")),1)])):p("",!0)])]))}},jt=at(Ft,[["__scopeId","data-v-ac3f0985"]]);export{jt as default};
