import{_ as j}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{r as g,c as b,P as V,Q as k,$ as E,j as s,W as r,Y as F,a0 as Z,Z as C,a1 as G,V as J,_ as K,e as X,u as n,B as I}from"./vue-vendor-DEVBTxx0.js";import{u as ee,b as ae,i as T,c as P,d as L}from"./index-tPAe9Dy4.js";/* empty css              *//* empty css              *//* empty css              */import{Field as A,Picker as oe,Popup as le,NavBar as te,Icon as se,Button as ne,showToast as re,showSuccessToast as R}from"./vant-CoNmWDyF.js";import{h as M}from"./errorHandler-D1LKPKx3.js";const ie={class:"base-select"},de={key:0,class:"select-label"},ue={key:0,class:"required-mark"},me={class:"label-text"},ce={__name:"BaseSelect",props:{modelValue:{type:[String,Number],default:""},options:{type:Array,required:!0,default:()=>[]},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},errorMessage:{type:String,default:""},title:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},position:{type:String,default:"bottom"},round:{type:Boolean,default:!0},closeOnClickOverlay:{type:Boolean,default:!0},columnsFieldNames:{type:Object,default:()=>({text:"text",value:"value"})}},emits:["update:modelValue","change","confirm","cancel"],setup(d,{emit:$}){const i=d,l=$,y=g(!1),S=b(()=>i.options),u=b(()=>{i.columnsFieldNames.text;const o=i.columnsFieldNames.value;return i.options.find(_=>_[o]===i.modelValue)}),B=b(()=>{const o=i.columnsFieldNames.text;return u.value?u.value[o]:""}),v=()=>{i.disabled||(y.value=!0)},p=({selectedOptions:o})=>{const _=i.columnsFieldNames.value,m=o[0],w=m[_];y.value=!1,l("update:modelValue",w),l("change",w,m),l("confirm",w,m)},f=()=>{y.value=!1,l("cancel")};return(o,_)=>{const m=A,w=oe,h=le;return k(),V("div",ie,[d.label?(k(),V("div",de,[d.required?(k(),V("span",ue,"*")):E("",!0),r("span",me,F(d.label),1)])):E("",!0),s(m,{"model-value":B.value,placeholder:d.placeholder,"error-message":d.errorMessage,disabled:d.disabled,"is-link":"",readonly:"",onClick:v},Z({_:2},[o.$slots.icon?{name:"left-icon",fn:C(()=>[G(o.$slots,"icon",{},void 0,!0)]),key:"0"}:void 0]),1032,["model-value","placeholder","error-message","disabled"]),s(h,{show:y.value,"onUpdate:show":_[0]||(_[0]=N=>y.value=N),position:d.position,round:d.round,"close-on-click-overlay":d.closeOnClickOverlay},{default:C(()=>[s(w,{columns:S.value,"columns-field-names":d.columnsFieldNames,title:d.title||d.placeholder,onConfirm:p,onCancel:f},null,8,["columns","columns-field-names","title"])]),_:1},8,["show","position","round","close-on-click-overlay"])])}}},ve=j(ce,[["__scopeId","data-v-94476fcc"]]),pe={class:"login-container"},fe={class:"login-navbar-wrapper"},_e={class:"main-content"},he={class:"form-container"},ye={key:0,class:"login-form"},we={class:"form-item"},ge={class:"form-item"},be={class:"button-container"},Ve={class:"link-text"},ke={key:1,class:"register-form"},xe={class:"form-item"},Ce={class:"form-item"},Be={class:"form-item"},qe={class:"form-item"},$e={class:"form-item"},Se={class:"form-item"},Ue={key:0,class:"hint-text"},Fe={class:"form-item"},Ne={key:0,class:"form-item"},Te={class:"button-container"},Pe={__name:"Login",setup(d){const $=J(),i=K(),{t:l}=ee(),y=ae(),S=b(()=>i.query.mode==="register"),u=g(!1),B=g(!1),v=g(!1),p=g({first_name:!1,last_name:!1,email:!1,phone:!1,password:!1,password_confirmation:!1,invite_code:!1}),f=g({identifier:"",password:""}),o=g({first_name:"",last_name:"",email:"",phone:"",password:"",password_confirmation:"",user_type:"company_admin",invite_code:"",gender:"male",locale:"ru"}),_=g([{value:"company_admin",name:l("auth.company_admin")},{value:"expert",name:l("auth.expert")}]),m=b(()=>_.value.find(a=>a.value===o.value.user_type)||_.value[0]),w=b(()=>f.value.identifier&&f.value.password),h=b(()=>{const a=o.value,e={};p.value.first_name&&!a.first_name&&(e.first_name=l("validation.first_name_required")),p.value.last_name&&!a.last_name&&(e.last_name=l("validation.last_name_required"));const U=a.email&&T(a.email),c=a.phone&&P(a.phone),q=U||c;return p.value.email&&(a.email&&!T(a.email)?e.email=l("validation.email_invalid"):!q&&!a.email&&(e.email=l("validation.email_or_phone_required"))),p.value.phone&&(a.phone&&!P(a.phone)?e.phone=l("validation.phone_invalid"):!q&&!a.phone&&(e.phone=l("validation.email_or_phone_required"))),p.value.password&&(a.password?L(a.password)||(e.password=l("validation.password_weak")):e.password=l("validation.password_required")),p.value.password_confirmation&&(a.password_confirmation?a.password!==a.password_confirmation&&(e.password_confirmation=l("validation.password_mismatch")):e.password_confirmation=l("validation.password_confirmation_required")),m.value.value==="expert"&&p.value.invite_code&&!a.invite_code&&(e.invite_code=l("validation.invite_code_required")),e}),N=b(()=>{const a=o.value;if(!a.first_name||!a.last_name||!a.password||!a.password_confirmation)return!1;const e=a.email&&T(a.email),U=a.phone&&P(a.phone);return!(!e&&!U||a.email&&!T(a.email)||a.phone&&!P(a.phone)||!L(a.password)||a.password!==a.password_confirmation||m.value.value==="expert"&&!a.invite_code)}),x=a=>{p.value[a]=!0},H=()=>{$.back()},W=(a,e)=>{o.value.user_type=a},z=async()=>{if(!(!w.value||v.value)){v.value=!0;try{await y.login(f.value),R(l("auth.login_success")),setTimeout(()=>{$.replace({name:"Home"})},1500)}catch(a){M(a,l("auth.login_failed"))}finally{v.value=!1}}},D=a=>{if(!a)return"+7";if(a.startsWith("+")){const e=a.match(/^\+(\d{1,4})/);return e?`+${e[1]}`:"+7"}return"+7"},Q=async()=>{if(!(!N.value||v.value)){v.value=!0;try{const a={first_name:o.value.first_name,last_name:o.value.last_name,password:o.value.password,password_confirmation:o.value.password_confirmation,user_type:m.value.value,gender:o.value.gender,locale:o.value.locale};o.value.email&&(a.email=o.value.email),o.value.phone&&(a.phone=o.value.phone,a.country_code=D(o.value.phone)),m.value.value==="expert"&&(a.invite_code=o.value.invite_code),await y.register(a),R(l("auth.register_success")),setTimeout(()=>{$.replace({name:"Home"})},1500)}catch(a){M(a,l("auth.register_failed"))}finally{v.value=!1}}},Y=()=>{re(l("common.coming_soon"))};return X(()=>{y.initializeUserState(),i.query.identifier&&(S.value?i.query.type==="phone"?o.value.phone=i.query.identifier:i.query.type==="email"&&(o.value.email=i.query.identifier):f.value.identifier=i.query.identifier)}),(a,e)=>{const U=te,c=A,q=se,O=ne;return k(),V("div",pe,[r("div",fe,[s(U,{title:S.value?n(l)("auth.register"):n(l)("auth.login"),"left-arrow":"",onClickLeft:H},null,8,["title"])]),r("div",_e,[r("div",he,[S.value?(k(),V("div",ke,[r("div",xe,[s(ve,{modelValue:o.value.user_type,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.user_type=t),options:_.value,label:n(l)("auth.user_type"),placeholder:n(l)("auth.select_user_type"),"columns-field-names":{text:"name",value:"value"},required:"",onChange:W},null,8,["modelValue","options","label","placeholder"])]),r("div",Ce,[s(c,{modelValue:o.value.first_name,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.first_name=t),placeholder:n(l)("auth.first_name"),"error-message":h.value.first_name,clearable:"",onBlur:e[5]||(e[5]=t=>x("first_name"))},null,8,["modelValue","placeholder","error-message"])]),r("div",Be,[s(c,{modelValue:o.value.last_name,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.last_name=t),placeholder:n(l)("auth.last_name"),"error-message":h.value.last_name,clearable:"",onBlur:e[7]||(e[7]=t=>x("last_name"))},null,8,["modelValue","placeholder","error-message"])]),r("div",qe,[s(c,{modelValue:o.value.email,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.email=t),type:"email",placeholder:n(l)("auth.email"),"error-message":h.value.email,clearable:"",onBlur:e[9]||(e[9]=t=>x("email"))},null,8,["modelValue","placeholder","error-message"])]),r("div",$e,[s(c,{modelValue:o.value.phone,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.phone=t),type:"tel",placeholder:n(l)("auth.phone"),"error-message":h.value.phone,clearable:"",onBlur:e[11]||(e[11]=t=>x("phone"))},null,8,["modelValue","placeholder","error-message"])]),r("div",Se,[s(c,{modelValue:o.value.password,"onUpdate:modelValue":e[13]||(e[13]=t=>o.value.password=t),type:u.value?"text":"password",placeholder:n(l)("auth.password"),"error-message":h.value.password,clearable:"",onBlur:e[14]||(e[14]=t=>x("password"))},{button:C(()=>[s(q,{name:u.value?"eye-o":"closed-eye",onClick:e[12]||(e[12]=t=>u.value=!u.value)},null,8,["name"])]),_:1},8,["modelValue","type","placeholder","error-message"]),o.value.password&&!h.value.password?(k(),V("div",Ue,F(n(l)("validation.password_hint")),1)):E("",!0)]),r("div",Fe,[s(c,{modelValue:o.value.password_confirmation,"onUpdate:modelValue":e[16]||(e[16]=t=>o.value.password_confirmation=t),type:B.value?"text":"password",placeholder:n(l)("auth.confirm_password"),"error-message":h.value.password_confirmation,clearable:"",onBlur:e[17]||(e[17]=t=>x("password_confirmation"))},{button:C(()=>[s(q,{name:B.value?"eye-o":"closed-eye",onClick:e[15]||(e[15]=t=>B.value=!B.value)},null,8,["name"])]),_:1},8,["modelValue","type","placeholder","error-message"])]),m.value.value==="expert"?(k(),V("div",Ne,[s(c,{modelValue:o.value.invite_code,"onUpdate:modelValue":e[18]||(e[18]=t=>o.value.invite_code=t),placeholder:n(l)("auth.invite_code"),"error-message":h.value.invite_code,clearable:"",onBlur:e[19]||(e[19]=t=>x("invite_code"))},null,8,["modelValue","placeholder","error-message"])])):E("",!0),r("div",Te,[s(O,{type:"primary",block:"",round:"",disabled:!N.value,loading:v.value,onClick:Q},{default:C(()=>[I(F(n(l)("auth.register")),1)]),_:1},8,["disabled","loading"])])])):(k(),V("div",ye,[r("div",we,[s(c,{modelValue:f.value.identifier,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value.identifier=t),placeholder:n(l)("auth.email_or_phone"),clearable:""},null,8,["modelValue","placeholder"])]),r("div",ge,[s(c,{modelValue:f.value.password,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value.password=t),type:u.value?"text":"password",placeholder:n(l)("auth.password"),clearable:""},{button:C(()=>[s(q,{name:u.value?"eye-o":"closed-eye",onClick:e[1]||(e[1]=t=>u.value=!u.value)},null,8,["name"])]),_:1},8,["modelValue","type","placeholder"])]),r("div",be,[s(O,{type:"primary",block:"",round:"",disabled:!w.value,loading:v.value,onClick:z},{default:C(()=>[I(F(n(l)("auth.login")),1)]),_:1},8,["disabled","loading"])]),r("div",{class:"forgot-password",onClick:Y},[r("span",Ve,F(n(l)("auth.forgot_password")),1)])]))])])])}}},Ye=j(Pe,[["__scopeId","data-v-d08ede38"]]);export{Ye as default};
