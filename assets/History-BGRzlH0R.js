import{_ as L}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              */import{r as p,w as H,P as y,Q as _,j as f,W as i,u as w,Y as b,$ as A,F as E,X as M,y as $,c as k,a5 as Y,V as G,_ as J,e as K,Z as I,a4 as q}from"./vue-vendor-DEVBTxx0.js";import{u as B}from"./index-tPAe9Dy4.js";import{C as ee}from"./CustomNavBar-BJGtUQrX.js";import{A as ae}from"./AppTabBar-Bp-nD9mT.js";/* empty css              *//* empty css              *//* empty css              */import{Search as te,Icon as N,List as se,Empty as le,PullRefresh as ne,showToast as z}from"./vant-CoNmWDyF.js";import{a as oe}from"./consultation-CmWwUlcj.js";import"./index_logo-B4Lpufyb.js";const ie={class:"search-filter-bar"},ce={class:"f-text"},re={__name:"SearchFilterBar",props:{modelValue:{type:String,default:""}},emits:["search","toggle-filter","update:modelValue"],setup(a,{emit:g}){const{t}=B(),e=a,d=g,r=p(e.modelValue),o=p(!1);H(()=>e.modelValue,m=>{r.value=m}),H(r,m=>{d("update:modelValue",m)});function s(){d("search",r.value)}function h(){o.value=!o.value,d("toggle-filter",o.value)}return(m,n)=>{const C=te,V=N;return _(),y("div",ie,[f(C,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=S=>r.value=S),placeholder:w(t)("common.search"),onSearch:s,onClear:s,shape:"round",class:"search-input"},null,8,["modelValue","placeholder"]),i("div",{class:"filter-btn",onClick:h},[n[1]||(n[1]=i("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M2 4h12M4 8h8M6 12h4",stroke:"#999999","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),i("span",ce,b(w(t)("common.filter")),1),f(V,{name:o.value?"arrow-up":"arrow-down",size:"14",color:"#999999"},null,8,["name"])])])}}},ue=L(re,[["__scopeId","data-v-b0d4f7aa"]]),de={key:0,class:"filter-panel"},he={class:"status-tags"},ve=["onClick"],me={__name:"FilterPanel",props:{show:{type:Boolean,default:!1},statuses:{type:Array,default:()=>[]},currentFilter:{type:String,default:""}},emits:["status-change"],setup(a,{emit:g}){const{t}=B(),e=g;function d(r){e("status-change",r)}return(r,o)=>a.show?(_(),y("div",de,[i("div",he,[(_(!0),y(E,null,M(a.statuses,s=>(_(),y("div",{key:s.value,class:$(["status-chip",{active:a.currentFilter===s.value}]),onClick:h=>d(s.value)},b(s.label),11,ve))),128)),a.currentFilter?(_(),y("div",{key:0,class:"status-chip clear",onClick:o[0]||(o[0]=s=>d(""))},b(w(t)("common.reset")),1)):A("",!0)])])):A("",!0)}},pe=L(me,[["__scopeId","data-v-920107c7"]]),fe={class:"card-hd"},_e={class:"title ellipsis"},ge={class:"desc ellipsis2"},be={class:"meta-row"},ye={class:"date-chip"},Ce={class:"date-text"},ke=["disabled"],we={__name:"HistoryCard",props:{item:{type:Object,required:!0},statusLabels:{type:Object,default:()=>({pending:"待处理",in_progress:"处理中",archived:"已归档",cancelled:"已取消"})},chatLabel:{type:String,default:"进入聊天"},chatUnavailableLabel:{type:String,default:"暂不可聊"}},emits:["chat-click","card-click"],setup(a,{emit:g}){const t=a,e=g,d=k(()=>t.statusLabels[t.item.status]||"待处理"),r=k(()=>!t.item.date&&!t.item.created_at?"":new Date(t.item.date||t.item.created_at).toLocaleDateString("en-CA",{timeZone:"Asia/Almaty",year:"numeric",month:"2-digit",day:"2-digit"}));function o(){e("card-click",t.item)}function s(){t.item.chatAvailable&&e("chat-click",t.item)}return(h,m)=>{const n=N;return _(),y("div",{class:"history-card",onClick:o},[i("div",fe,[i("span",_e,b(a.item.title),1),i("div",{class:$(["state-badge",a.item.status])},b(d.value),3)]),i("div",ge,b(a.item.desc||a.item.description),1),i("div",be,[i("div",ye,[f(n,{name:"calendar-o",size:"15",color:"#9E9E9E"}),i("span",Ce,b(r.value),1)])]),i("button",{class:$(["chat-btn",{disabled:!a.item.chatAvailable}]),disabled:!a.item.chatAvailable,onClick:Y(s,["stop"])},[f(n,{name:"chat-o",size:"17",color:a.item.chatAvailable?"#FFFFFF":"#6BA1F5"},null,8,["color"]),i("span",null,b(a.item.chatAvailable?a.chatLabel:a.chatUnavailableLabel),1)],10,ke)])}}},Fe=L(we,[["__scopeId","data-v-e5ead18c"]]),Le={class:"history-page"},Ve=10,Se={__name:"History",setup(a){const g=G(),t=J(),{t:e}=B(),d=p(""),r=p(!1),o=p({status:t.query.status||""}),s=p([]),h=p(!1),m=p(!1),n=p(!1),C=p(1),V=k(()=>[{value:"pending",label:e("status.pending")},{value:"in_progress",label:e("status.in_progress")},{value:"archived",label:e("status.archived")},{value:"cancelled",label:e("status.cancelled")}]),S=k(()=>({pending:e("status.pending"),in_progress:e("status.in_progress"),archived:e("status.archived"),cancelled:e("status.cancelled")})),R=k(()=>e("history.go_chat")),T=k(()=>e("history.chat_unavailable"));function j(c){r.value=c}function P(c){o.value.status=c,C.value=1,s.value=[],n.value=!1,F()}function O(){C.value=1,s.value=[],n.value=!1,F()}async function F(){if(!h.value){h.value=!0;try{const c={page:C.value,per_page:Ve};o.value.status&&(c.status=o.value.status);const u=await oe(c);if(u.success&&u.data){const x=(u.data.data||[]).map(l=>{var v,D;return{id:l.id,title:l.title,desc:l.description,description:l.description,status:l.status,date:l.created_at,created_at:l.created_at,chat_id:l.chat_id,chatAvailable:l.chatAvailable||!!l.chat_id,hasUnread:l.hasUnread||l.has_unread_messages||!1,creator:l.creatorName||((v=l.creator)==null?void 0:v.full_name)||"",category:l.topic_type||"",expert_name:((D=l.assignedLawyer)==null?void 0:D.full_name)||""}});u.data.current_page>=u.data.last_page&&(n.value=!0),s.value=[...s.value,...x],C.value++}else n.value=!0}catch(c){console.error("Failed to load history:",c),z(e("common.load_failed")),n.value=!0}finally{h.value=!1}}}async function Q(){C.value=1,s.value=[],n.value=!1,await F(),m.value=!1}function Z(){n.value||F()}function W(c){g.push({name:"HistoryDetail",params:{id:c.id}})}function X(c){c.chat_id?g.push({name:"ChatConversation",params:{id:c.chat_id}}):z(e("history.chat_unavailable"))}return K(()=>{t.query.status&&(o.value.status=t.query.status),F()}),(c,u)=>{const U=le,x=se,l=ne;return _(),y("div",null,[f(ee,{title:""}),i("div",Le,[f(ue,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=v=>d.value=v),onSearch:O,onToggleFilter:j},null,8,["modelValue"]),f(pe,{show:r.value,statuses:V.value,"current-filter":o.value.status,onStatusChange:P},null,8,["show","statuses","current-filter"]),f(l,{modelValue:m.value,"onUpdate:modelValue":u[2]||(u[2]=v=>m.value=v),onRefresh:Q},{default:I(()=>[f(x,{loading:h.value,"onUpdate:loading":u[1]||(u[1]=v=>h.value=v),finished:n.value,"loading-text":w(e)("common.loading"),"finished-text":w(e)("common.no_more_data"),onLoad:Z},{default:I(()=>[s.value.length===0&&!h.value?(_(),q(U,{key:0,description:w(e)("common.no_records")},null,8,["description"])):A("",!0),(_(!0),y(E,null,M(s.value,v=>(_(),q(Fe,{key:v.id,item:v,"status-labels":S.value,"chat-label":R.value,"chat-unavailable-label":T.value,onChatClick:X,onCardClick:W},null,8,["item","status-labels","chat-label","chat-unavailable-label"]))),128))]),_:1},8,["loading","finished","loading-text","finished-text"])]),_:1},8,["modelValue"])]),f(ae,{"active-tab":"history"})])}}},Te=L(Se,[["__scopeId","data-v-84d36105"]]);export{Te as default};
