import{_ as N}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              */import{V as j,r as w,e as A,P as r,Q as n,j as m,W as o,Z as f,a4 as F,B as R,Y as c,u as l,F as D,X as L,$ as v}from"./vue-vendor-DEVBTxx0.js";import{l as Y,m as Z,u as q,n as P}from"./index-tPAe9Dy4.js";import{C as z}from"./CustomNavBar-BJGtUQrX.js";import{A as G}from"./AppTabBar-Bp-nD9mT.js";import{g as Q}from"./avatar-BoreVJuD.js";import{Loading as W,Empty as X,Icon as H,PullRefresh as J,showToast as C}from"./vant-CoNmWDyF.js";import"./index_logo-B4Lpufyb.js";const K={class:"page"},O={class:"chat-list-page"},ee={key:0,class:"loading-container"},te={class:"empty-title"},ae={class:"empty-desc"},se={key:2,class:"chat-list"},oe=["onClick"],ne={class:"chat-avatar-wrapper"},re={class:"chat-avatar"},ie=["src"],ce={key:1,class:"avatar-placeholder"},le={key:0,class:"online-indicator"},de={class:"chat-content"},_e={class:"chat-header"},ue={class:"chat-name-wrapper"},me={class:"chat-name"},he={key:0,class:"chat-role-badge"},pe={class:"chat-meta"},fe={class:"chat-time"},ve={key:0,class:"unread-badge"},ge={class:"chat-preview"},ye={key:0,class:"private-pill"},we={class:"chat-message"},Ce={class:"chat-arrow"},ke={__name:"Chat",setup(xe){const M=j(),h=Y(),{connect:T}=Z(),{t}=q(),d=w([]),g=w(!1),y=w(!1);function b(e){if(!e)return"?";const a=e.trim().split(/\s+/);return a.length>=2?(a[0][0]+a[1][0]).toUpperCase():e.substring(0,2).toUpperCase()}function S(e){if(!e)return"";const a=new Date(e),_=new Date-a,u=Math.floor(_/6e4),p=Math.floor(_/36e5),s=Math.floor(_/864e5);return u<1?t("chat.just_now"):u<60?`${u}${t("common.minutes_ago")}`:p<24?`${p}${t("common.hours_ago")}`:s<7?`${s}${t("common.days_ago")}`:a.toLocaleDateString(t("common.locale_code"),{month:"short",day:"numeric",timeZone:"Asia/Almaty"})}function V(e){return{lawyer:t("chat.role_lawyer"),client:t("chat.role_client"),expert:t("chat.role_expert"),admin:t("chat.role_admin")}[e]||e}function $(e){e.target.style.display="none"}function k(e){return e?e.unreadCount??e.unread_count??0:0}function B(e){return e?e>99?"99+":e:""}function x(e){if(!e)return{isPrivate:!1,text:t("chat.start_conversation")};if(e.lastMessageSummary){const i=e.lastMessageSummary;if(i.isPrivate||i.type==="private")return{isPrivate:!0,text:i.content||t("chat.private_message_generic")};switch(i.type){case"image":return{isPrivate:!1,text:"[IMG]"};case"document":case"file":return{isPrivate:!1,text:"[FILE]"};case"system":return{isPrivate:!1,text:i.content||"[SYSTEM]"};case"user_joined":case"lawyer_joined":case"operator_joined":case"lawyer_removed":case"consultation_status_changed":case"consultation_archived":case"consultation_unarchived":return{isPrivate:!1,text:i.content||t("chat.system_events.generic")};default:return{isPrivate:!1,text:i.content||t("chat.start_conversation")}}}const a=e.lastMessage||"";return a==="chat.privateMessage"||a==="chat.private_message"?{isPrivate:!0,text:t("chat.private_message_generic")}:{isPrivate:!1,text:a||t("chat.start_conversation")}}function I(e){M.push({name:"ChatConversation",params:{id:e.id},query:{title:e.title||e.name}})}async function U(){g.value=!0;try{await h.fetchChats(),d.value=h.chats}catch(e){console.error("Failed to load chats:",e),C(t("chat.load_failed"))}finally{g.value=!1}}async function E(){try{await h.fetchChats(),d.value=h.chats,C(t("common.refresh_success"))}catch(e){console.error("Failed to refresh chats:",e),C(t("chat.load_failed"))}finally{y.value=!1}}return A(async()=>{await new Promise(a=>setTimeout(a,50));let e=P();e||(await new Promise(a=>setTimeout(a,100)),e=P()),e?U():console.warn("No token available, skipping chat list load"),T()}),(e,a)=>{const i=W,_=X,u=H,p=J;return n(),r("div",K,[m(z,{title:"","show-points-menu":!0,"show-bell":!1}),o("div",O,[m(p,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=s=>y.value=s),onRefresh:E},{default:f(()=>[g.value&&d.value.length===0?(n(),r("div",ee,[m(i,{vertical:""},{default:f(()=>[R(c(l(t)("common.loading")),1)]),_:1})])):d.value.length===0?(n(),F(_,{key:1,class:"empty-state",description:l(t)("chat.no_chats_yet")},{image:f(()=>[...a[1]||(a[1]=[o("div",{class:"empty-icon"},"ðŸ’¬",-1)])]),description:f(()=>[o("p",te,c(l(t)("chat.no_chats_title")),1),o("p",ae,c(l(t)("chat.no_chats_desc")),1)]),_:1},8,["description"])):(n(),r("div",se,[(n(!0),r(D,null,L(d.value,s=>(n(),r("div",{key:s.id,class:"chat-item",onClick:Pe=>I(s)},[o("div",ne,[o("div",re,[s.avatar?(n(),r("img",{key:0,src:l(Q)(s.avatar),class:"avatar-img",onError:$},null,40,ie)):(n(),r("div",ce,c(b(s.name)),1))]),s.hasUpdates?(n(),r("div",le)):v("",!0)]),o("div",de,[o("div",_e,[o("div",ue,[o("span",me,c(s.name||l(t)("chat.unnamed")),1),s.role?(n(),r("span",he,c(V(s.role)),1)):v("",!0)]),o("div",pe,[o("span",fe,c(S(s.lastMessageTime)),1),k(s)>0?(n(),r("span",ve,c(B(k(s))),1)):v("",!0)])]),o("div",ge,[x(s).isPrivate?(n(),r("span",ye,c(l(t)("chat.private_badge")),1)):v("",!0),o("span",we,c(x(s).text),1)])]),o("div",Ce,[m(u,{name:"arrow",size:"16",color:"#C4C4C4"})])],8,oe))),128))]))]),_:1},8,["modelValue"])]),m(G,{"active-tab":"chat"})])}}},je=N(ke,[["__scopeId","data-v-bd70e272"]]);export{je as default};
