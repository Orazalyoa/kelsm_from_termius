import{_ as ye}from"./_plugin-vue_export-helper-BgbHP9iJ.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{V as ve,r as f,c as B,e as fe,P as c,Q as l,j as r,W as s,$ as k,u as n,a4 as A,Y as i,Z as y,B as d,F as b,X as O,a5 as he,y as xe}from"./vue-vendor-DEVBTxx0.js";import{_ as ge}from"./doc-0ztv5d3O.js";import{A as we,k as Ce,B as ke,u as be,b as De,j as v,f as $}from"./index-tPAe9Dy4.js";import{b as Me,r as ze}from"./organization-CXFvl_zb.js";import{C as Te}from"./CustomNavBar-BJGtUQrX.js";import{Loading as Be,Icon as Ve,Button as Ae,Form as Se,Field as Ue,CellGroup as $e,Cell as Fe,Switch as Ie,NoticeBar as Pe,Popup as Ee,Picker as Ne,Empty as Oe,Popover as Le,showToast as L,showDialog as j}from"./vant-CoNmWDyF.js";import"./index_logo-B4Lpufyb.js";const je=g=>we("/invite-codes",g),Ge=(g={})=>Ce("/invite-codes",g),Re=g=>ke(`/invite-codes/${g}`),Ze={class:"company-manage-container"},qe={class:"company-info-section"},Qe={class:"company-info-card"},We={class:"company-details"},Xe={class:"company-name"},Ye={class:"company-id"},He={class:"participants-section"},Je={class:"section-title"},Ke={key:0,class:"loading-wrapper"},et={key:2,class:"participants-list"},tt={class:"participant-avatar"},ot={class:"participant-info"},at={class:"participant-name"},nt={key:0,class:"you-tag"},st={class:"participant-role"},it={key:0,class:"invite-codes-section"},lt={class:"section-title"},rt={key:0,class:"loading-wrapper"},ct={key:2,class:"invite-codes-list"},pt={class:"code-main"},mt={class:"code-info"},ut={class:"code-value"},dt={class:"code-stats"},_t={class:"stat-item"},yt={class:"stat-item"},vt={class:"code-meta"},ft={class:"user-type-badge"},ht={key:0,class:"creator-info"},xt={class:"code-actions"},gt={key:1,class:"add-button-wrapper"},wt={class:"create-code-dialog"},Ct={class:"dialog-title"},kt={key:0,class:"permission-section"},bt={key:1,class:"admin-permission-hint"},Dt={class:"expires-hint"},Mt={class:"dialog-actions"},zt={__name:"CompanyManage",setup(g){const G=ve(),{t:o}=be(),m=De(),h=f(!1),D=f(!1),S=f(!1),x=f([]),V=f([]),M=f(!1),z=f(!1),u=f({user_type:"expert",max_uses:1,can_apply_consultation:!0}),F=B(()=>[{text:o("company.user_type_expert"),value:"expert"},{text:o("company.user_type_company_admin"),value:"company_admin"}]),I=B(()=>{const t=F.value.find(e=>e.value===u.value.user_type);return t?t.text:""}),R=B(()=>u.value.user_type==="expert"),Z=B(()=>{var t;return((t=m.organizations[0])==null?void 0:t.name)||""}),q=B(()=>{var t;return((t=m.organizations[0])==null?void 0:t.company_id)||""}),Q=t=>{const e=[];return t.is_current_user||e.push({text:o("company.delete"),icon:"delete",value:"delete",className:"delete-action"}),e},W=async(t,e)=>{e.showMenu=!1,t.value==="delete"&&await ne(e)},X=()=>{G.push({name:"EditOrg"})},Y=async()=>{if(!m.organizations||m.organizations.length===0)try{h.value=!0,await m.fetchUserOrganizations()}catch(e){console.error("Failed to load organizations:",e),v(o("company.load_members_failed")),h.value=!1;return}const t=[H()];m.isCompanyAdmin&&t.push(U()),await Promise.all(t)},H=async()=>{const t=m.organizations[0];if(!(t!=null&&t.id)){v(o("company.load_members_failed"));return}h.value=!0;try{const e=await Me(t.id),p=e.members||e.data||e||[];x.value=p.map(_=>{var w;return{id:_.id,name:`${_.first_name||""} ${_.last_name||""}`.trim()||o("company.name_surname"),role:J(_.role),is_current_user:_.id===((w=m.user)==null?void 0:w.id),showMenu:!1,rawData:_}})}catch(e){console.error("Failed to load members:",e),v(o("company.load_members_failed")),x.value=[]}finally{h.value=!1}},U=async()=>{if(!m.isCompanyAdmin)return;const t=m.organizations[0];if(t!=null&&t.id){D.value=!0;try{const e=await Ge({organization_id:t.id});V.value=e.invite_codes||e.data||[]}catch(e){console.error("Failed to load invite codes:",e),v(o("company.load_codes_failed")),V.value=[]}finally{D.value=!1}}},J=t=>({owner:o("company.director"),admin:o("company.manager"),member:o("company.position"),lawyer:o("chat.role_lawyer")})[t==null?void 0:t.toLowerCase()]||t||o("company.position"),K=t=>{if(!t)return"";try{const e=new Date(t),_=e-new Date;return Math.ceil(_/(1e3*60*60*24))<0?o("company.expired"):e.toLocaleDateString("en-CA",{timeZone:"Asia/Almaty",year:"numeric",month:"2-digit",day:"2-digit"})}catch(e){return console.error("Date format error:",e),t}},ee=t=>t.max_uses&&t.used_count>=t.max_uses?o("company.used"):t.expires_at&&new Date(t.expires_at)<new Date?o("company.expired"):t.is_valid?o("company.active"):o("company.inactive"),te=t=>t.max_uses&&t.used_count>=t.max_uses?"used":t.expires_at&&new Date(t.expires_at)<new Date?"expired":t.is_valid?"active":"inactive",oe=t=>!(t.max_uses&&t.used_count>=t.max_uses||t.expires_at&&new Date(t.expires_at)<new Date),ae=t=>({expert:o("company.user_type_expert"),company_admin:o("company.user_type_company_admin")})[t]||t,ne=async t=>{try{await j({title:o("company.delete"),message:o("company.delete_member_confirm"),showCancelButton:!0,confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel")});const e=m.organizations[0];if(!(e!=null&&e.id))return;h.value=!0,await ze(e.id,t.id);const p=x.value.findIndex(_=>_.id===t.id);p>-1&&x.value.splice(p,1),$(o("company.delete_member_success"))}catch(e){e!=="cancel"&&(console.error("Failed to delete member:",e),v(o("company.delete_member_failed")))}finally{h.value=!1}},se=({selectedOptions:t})=>{u.value.user_type=t[0].value,z.value=!1,u.value.user_type==="company_admin"&&(u.value.can_apply_consultation=!0)},ie=async()=>{const t=m.organizations[0];if(!(t!=null&&t.id)){v(o("company.generate_code_failed"));return}S.value=!0;try{const e={organization_id:t.id,user_type:u.value.user_type,max_uses:parseInt(u.value.max_uses)},p=new Date;p.setDate(p.getDate()+30),e.expires_at=p.toISOString().split("T")[0]+" 23:59:59",u.value.user_type==="expert"&&(e.permissions={can_apply_consultation:u.value.can_apply_consultation}),await je(e),$(o("company.code_generated")),M.value=!1,u.value={user_type:"expert",max_uses:1,can_apply_consultation:!0},await U()}catch(e){console.error("Failed to generate invite code:",e),v(o("company.generate_code_failed"))}finally{S.value=!1}},le=async t=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(t),L({message:o("company.code_copied"),position:"top"});else{const e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),L({message:o("company.code_copied"),position:"top"})}}catch(e){console.error("Failed to copy code:",e),v(o("common.error"))}},re=async t=>{try{await j({title:o("company.delete_code"),message:o("company.delete_code_confirm"),showCancelButton:!0,confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel")}),D.value=!0,await Re(t.id),$(o("company.code_deleted")),await U()}catch(e){e!=="cancel"&&(console.error("Failed to delete invite code:",e),v(o("company.delete_code_failed")))}finally{D.value=!1}};return fe(()=>{Y()}),(t,e)=>{const p=Ve,_=Be,w=Oe,ce=Le,T=Ae,P=Ue,E=Fe,pe=Ie,me=$e,ue=Pe,de=Se,N=Ee,_e=Ne;return l(),c("div",Ze,[r(Te,{title:n(o)("app.name"),"show-logo":!1,"show-bell":!0},null,8,["title"]),s("div",qe,[s("div",Qe,[e[9]||(e[9]=s("img",{src:ge,class:"company-icon",alt:""},null,-1)),s("div",We,[s("p",Xe,i(Z.value),1),s("p",Ye,i(q.value),1)]),n(m).isCompanyAdmin?(l(),A(p,{key:0,name:"edit",class:"edit-icon",onClick:X})):k("",!0)])]),s("div",He,[s("h3",Je,i(n(o)("company.participant_count",{count:x.value.length})),1),h.value?(l(),c("div",Ke,[r(_,{size:"24px"},{default:y(()=>[d(i(n(o)("common.loading")),1)]),_:1})])):x.value.length===0?(l(),A(w,{key:1,description:n(o)("chat.no_participants")},null,8,["description"])):(l(),c("div",et,[(l(!0),c(b,null,O(x.value,a=>(l(),c("div",{key:a.id,class:"participant-item"},[s("div",tt,[r(p,{name:"manager",size:"24",color:"#4A90E2"})]),s("div",ot,[s("p",at,[d(i(a.name)+" ",1),a.is_current_user?(l(),c("span",nt,"("+i(n(o)("profile.you"))+")",1)):k("",!0)]),s("p",st,i(a.role),1)]),r(ce,{show:a.showMenu,"onUpdate:show":C=>a.showMenu=C,placement:"bottom-end",actions:Q(a),onSelect:C=>W(C,a)},{reference:y(()=>[r(p,{name:"ellipsis",size:"20",class:"menu-icon",onClick:he(C=>a.showMenu=!0,["stop"])},null,8,["onClick"])]),_:2},1032,["show","onUpdate:show","actions","onSelect"])]))),128))]))]),n(m).isCompanyAdmin?(l(),c("div",it,[s("h3",lt,i(n(o)("company.invite_codes")),1),D.value?(l(),c("div",rt,[r(_,{size:"24px"},{default:y(()=>[d(i(n(o)("common.loading")),1)]),_:1})])):V.value.length===0?(l(),A(w,{key:1,description:n(o)("company.no_invite_codes")},null,8,["description"])):(l(),c("div",ct,[(l(!0),c(b,null,O(V.value,a=>(l(),c("div",{key:a.id,class:"invite-code-item"},[s("div",pt,[s("div",mt,[s("p",ut,i(a.code),1),s("div",dt,[s("span",_t,[d(i(n(o)("company.uses"))+": "+i(a.used_count||0)+" ",1),a.max_uses?(l(),c(b,{key:0},[d(" / "+i(a.max_uses),1)],64)):(l(),c(b,{key:1},[d(" ("+i(n(o)("company.unlimited"))+") ",1)],64))]),e[10]||(e[10]=s("span",{class:"stat-divider"},"â€¢",-1)),s("span",yt,[d(i(n(o)("company.expires_at"))+": ",1),a.expires_at?(l(),c(b,{key:0},[d(i(K(a.expires_at)),1)],64)):(l(),c(b,{key:1},[d(i(n(o)("company.never_expires")),1)],64))])]),s("div",vt,[s("span",{class:xe(["status-badge",te(a)])},i(ee(a)),3),s("span",ft,i(ae(a.user_type)),1),a.creator?(l(),c("span",ht,i(n(o)("company.created_by"))+": "+i(a.creator.full_name),1)):k("",!0)])]),s("div",xt,[r(T,{size:"small",type:"primary",plain:"",onClick:C=>le(a.code)},{default:y(()=>[d(i(n(o)("company.copy_code")),1)]),_:1},8,["onClick"]),oe(a)?(l(),A(T,{key:0,size:"small",type:"danger",plain:"",onClick:C=>re(a)},{default:y(()=>[d(i(n(o)("company.delete_code")),1)]),_:1},8,["onClick"])):k("",!0)])])]))),128))]))])):k("",!0),n(m).isCompanyAdmin?(l(),c("div",gt,[r(T,{type:"primary",block:"",class:"generate-code-btn",onClick:e[0]||(e[0]=a=>M.value=!0)},{default:y(()=>[r(p,{name:"plus"}),d(" "+i(n(o)("company.generate_invite_code")),1)]),_:1})])):k("",!0),r(N,{show:M.value,"onUpdate:show":e[6]||(e[6]=a=>M.value=a),position:"bottom",round:"",style:{padding:"20px"}},{default:y(()=>[s("div",wt,[s("h3",Ct,i(n(o)("company.create_invite_code")),1),r(de,{onSubmit:ie},{default:y(()=>[r(P,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),readonly:"",clickable:"",label:n(o)("company.user_type_label"),onClick:e[2]||(e[2]=a=>z.value=!0)},null,8,["modelValue","label"]),R.value?(l(),c("div",kt,[r(me,{inset:""},{default:y(()=>[r(E,{title:n(o)("company.permissions_label")},null,8,["title"]),r(E,{title:n(o)("company.can_apply_consultation"),center:""},{"right-icon":y(()=>[r(pe,{modelValue:u.value.can_apply_consultation,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.can_apply_consultation=a),size:"20"},null,8,["modelValue"])]),_:1},8,["title"])]),_:1})])):(l(),c("div",bt,[r(ue,{text:n(o)("company.expert_has_full_permissions"),"left-icon":"info-o",color:"#1989fa",background:"#ecf9ff"},null,8,["text"])])),r(P,{modelValue:u.value.max_uses,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.max_uses=a),type:"number",label:n(o)("company.max_uses_label"),placeholder:n(o)("company.max_uses_placeholder"),rules:[{required:!0,message:n(o)("company.max_uses_placeholder")},{pattern:/^[1-9]\d*$/,message:n(o)("company.max_uses_placeholder")},{validator:a=>a>=1&&a<=100,message:n(o)("company.max_uses_placeholder")}]},null,8,["modelValue","label","placeholder","rules"]),s("div",Dt,[r(p,{name:"clock-o"}),s("span",null,i(n(o)("company.expires_30_days")),1)]),s("div",Mt,[r(T,{block:"",type:"default",onClick:e[5]||(e[5]=a=>M.value=!1)},{default:y(()=>[d(i(n(o)("common.cancel")),1)]),_:1}),r(T,{block:"",type:"primary","native-type":"submit",loading:S.value},{default:y(()=>[d(i(n(o)("common.confirm")),1)]),_:1},8,["loading"])])]),_:1})])]),_:1},8,["show"]),r(N,{show:z.value,"onUpdate:show":e[8]||(e[8]=a=>z.value=a),position:"bottom",round:""},{default:y(()=>[r(_e,{columns:F.value,onConfirm:se,onCancel:e[7]||(e[7]=a=>z.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},Qt=ye(zt,[["__scopeId","data-v-a3e983ec"]]);export{Qt as default};
